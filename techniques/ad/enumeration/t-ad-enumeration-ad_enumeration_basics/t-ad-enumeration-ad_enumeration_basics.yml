title: Active Directory Basic Enumeration (users, computers, groups, policies, trusts)
category: 
  - AD:
    - Enumeration
tactic: Discovery
tags: []
description: 
references: 
  - https://github.com/dirkjanm/ldapdomaindump
  - https://github.com/ropnop/go-windapsearch
  - https://github.com/adrecon/ADRecon
  - https://github.com/samratashok/ADModule
  - https://github.com/tevora-threat/SharpView

steps:
  - description: Dumping Active Directory basic information
    options: 
      - tool: Windows AD Powershell module
        usage: |
          Get-ADComputer -Filter * -Properties * | Select-Object Name,lastlogon,description,OperatingSystem,OperatingSystemServicePack | export-CSV adcomps.csv -NoTypeInformation -Encoding UTF8
          Get-ADUser -Filter * -Properties cn,SAMAccountName,displayName,enabled,Title,Department,Company,whenCreated,whenChanged,passwordlastset,EmailAddress,comment,description,MemberOf | Select-Object cn,SAMAccountName,displayName,enabled, EmailAddress,Title,Department,Company,whenCreated,whenChanged,passwordlastset,comment,description,@{name="MemberOf";expression={($_.Memberof | % {($_ | Get-ADGroup).Name}) -join ","}} | export-CSV adusers.csv -NoTypeInformation -Encoding UTF8
        comments: Portable version is available - https://github.com/samratashok/ADModule

      - tool: ADRecon.ps1
        usage: .\ADRecon.ps1 -DomainController <IP or FQDN> -Credential <domain\username>
        comments: The .ps1 script can be detected as malicious on the host
      
      - tool: PowerView.ps1
        usage: |
          Get-Domain
          Get-DomainUser -Properties cn,SAMAccountName,description,info,comment,displayName,Title,Department,Company,whenCreated,whenChanged,pwdlastset,lastlogontimestamp,MemberOf | export-CSV ad_users_info.csv -NoTypeInformation -Encoding UTF8
          Get-NetComputer -Properties ssn,lastlogon,operatingsystem,operatingsystemversion,location,description | export-CSV ad_computer_info.csv -NoTypeInformation -Encoding UTF8
          Get-NetDomainController
          Invoke-MapDomainTrust
          Get-DomainPolicyData
          Get-ForestDomain
          Get-DomainController
          Get-DomainTrust

          #for a particular user
          Get-DomainUser -Identity jking -Properties DisplayName, MemberOf | fl

          Get-DomainGroupMember -Identity "Domain Admins" | select MemberDistinguishedName
          Get-DomainGPOUserLocalGroupMapping
      
      - tool: SharpView.exe
        usage: |
          SharpView.exe Get-Domain
      
      - tool: ADSearch 
        usage: |
          ADSearch.exe --search "objectCategory=user"
          ADSearch.exe --search "(&(objectCategory=group)(cn=*Admins))"
          ADSearch.exe --search "(&(objectCategory=group)(cn=MS SQL Admins))" --attributes cn,member

      - tool: ldapdomaindump
        usage: ldapdomaindump -u <domain>\\<username> -p '<password>' <dc_address> -r -d ';' -n <ns_server>
        comments:
      
      - tool: go-windapsearch
        usage: |
          windapsearch-linux-amd64 -d <domain.com> --dc <dc01.domain.com> -u <user@domain.com> -p 'P@ssw0rd' -m users
        comments:
          - > 
            Available modules are admin-objects, computers, custom, dns-names, dns-zones, domain-admins, gpos,
            groups, members, metadata, privileged-users, search, unconstrained, user-spns, users 
      
comments: