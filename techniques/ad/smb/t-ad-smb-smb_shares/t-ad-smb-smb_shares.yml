title: SMB Shares Discovery
category: 
  - AD:
    - SMB
tactic: Collection
tags: []
description: |
  Sometimes companies do not restrict shares that contain sensitive data to only readable by 
  certain groups, and are open to all authenticated users or even without providing credentials (null/guest sessions). 
  Such resources can contain sensitive data, backups, passwords, configuration files, etc.

references:
  - https://github.com/Porchetta-Industries/CrackMapExec
  - https://github.com/ShawnDEvans/smbmap
  - https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1

steps:
  
  - description: Enumerate publicly accessible SMB shares
    options:
      - tool: crackmapexec
        usage: |
          crackmapexec smb <hosts_file> -u user -p 'P@ssw0rd' --shares
          cmedb
          cmedb (test)(smb) > export shares detailed shares.csv
    
      - tool: powerview
        usage: Find-DomainShare -CheckShareAccess

      - tool: smbmap
        usage: python3 smbmap.py -r --host-file $name -u user -d domain -p P@ssw0rd --csv authenticated_shares_$name --no-write-check --exclude ADMIN$ C$ IPC$
        comments:
          - Supports Pass-the-Hash
      
      - tool: smbclient
        usage: smbclient -L -U domain.com\\username //host.com
  
  - description: Access the SMB shares
    options:
      - tool: smbclient
        usage: |
          smbclient -U domain.com\\username //domain.com/sharename

          #kerberos
          impacket-smbclient -k domain/username:'P@ssw0rd'@dc.domain.com
  