title: ADCS Templates Enumeration
category: 
  - AD:
    - ADCS  
tactic: Discovery
tags: []
description:
  - title: Overview
    content: Once in an AD environment, we can find vulnerable certificate templates
    references: 
      - type: link
        value: https://github.com/ly4k/BloodHound/
      - type: link
        value: https://0xalwayslucky.gitbook.io/cybersecstack/active-directory/adcs-privesc-certificate-templates

steps:
  - description: Enumerate templates on the ADCS Server
    options: 
      - tool: certipy 
        usage: certipy find -u <user@domain.com> -p 'P@ssw0rd' -dc-ip <DC_IP>
        comments: 
          - > 
            Since certificate templates are domain object, ACL can have different ACL. 
            It makes sense to additionally export templates using different user accounts with 
            different group memberships.
      
      - tool: certify
        usage: |
          Certify.exe cas
          Certify.exe find /vulnerable
  
  - description: Find potentially vulnerable templates
    options: 
      - tool: certipy
        usage: | 
          certipy find -u <user@domain.com> -p 'P@ssw0rd' -dc-ip <DC_IP> -vulnerable

          bloodhound (ly4k) - use queries in GUI
          #OR manually
          jq '.[] |.[]| select(.["Enrollee Supplies Subject"] == true and .Enabled == true and .["Client Authentication"] == true)' filename.json

        comments:
          - vulnerable paramtere doesn't affect bloodhound output, these files always contain all templates including non-vulnerable.
      
comments: 