title: krbtgt Account Password Rotation
category: 
  - AD:
    - Kerberos
tactic: Discovery
tags: []
description:
  - title:
    content: The krbtgt account is a built-in account used in Microsoft Active Directory (AD) 
      environments to encrypt and sign Kerberos tickets. Kerberos is a network authentication 
      protocol used to provide secure authentication for client/server applications.

      The krbtgt account password should be changed regularly as a security best 
      practice to reduce the risk of unauthorized access to sensitive resources within 
      an organization. If an attacker gains access to the krbtgt account password, 
      they can create and forge valid Kerberos tickets for any user or service account 
      within the domain, enabling them to access sensitive data or systems.

      Changing the krbtgt account password on a regular basis helps to mitigate this 
      risk by limiting the window of opportunity for an attacker to use a compromised password.

steps:
  - description: Retrieve the last password change date for the krbtgt account
    options:
      - tool: powershell_ad_module
        usage: Get-ADUser krbtgt -Properties PasswordLastSet | Select-Object sAMAccountName, PasswordLastSet

      - tool: ldapsearch
        usage: |
          ldapsearch -x -H ldap://<dc_ip> -D "<user@domain.com>" -w '<password>' -b "DC=<domain,DC=com>" "(&(objectCategory=person)(objectClass=user)(sAMAccountName=krbtgt))" sAMAccountName pwdlastset
          D=<pwdLastSet>; date -d "01/01/1601 UTC $(let D=D/10000000; echo $D) seconds"

      - tool: bloodhound
        usage: MATCH (u:User) WHERE u.samaccountname="krbtgt" RETURN u.name,datetime({epochSeconds:toInteger(u.pwdlastset)})

