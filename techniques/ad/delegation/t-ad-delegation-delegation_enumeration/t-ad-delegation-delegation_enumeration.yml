title: Delegation Enumeration
category: 
  - AD:
    - Delegation
    - Kerberos
tactic: Discovery
tags: []

description: 

references:
steps: 
  - description: Find computers with enabled “TrustedForDelegation” flag (Unconstrained Delegation)
    options: 
      - tool: Powershell
        usage: Get-ADObject -ldapfilter "(userAccountControl:1.2.840.113556.1.4.803:=524288)"
        comments: 
      
      - tool: Powerview
        usage: |
          #For hosts:
          Get-DomainComputer -Unconstrained | select samaccountname

          #For accounts:
          Get-DomainUser -ldapfilter "(userAccountControl:1.2.840.113556.1.4.803:=524288)"
      
      - tool: impacket
        usage: |
          impacket-findDelegation hpbank.local/user
  
  - description: Find computers with enabled “msDS-AllowedToDelegateTo” attribute (Constrained Delegation, any authentication protocol)
    options: 
      - tool: Powerview
        usage: |
          Get-DomainUser -TrustedToAuth
          Get-NetComputer -TrustedToAuth -Properties samaccountname,msds-alloweddelegateto,useaccountcontrol | format-table -wrap
      
      - tool: impacket
        usage: |
          impacket-findDelegation hpbank.local/user
      
      - tool: ADSearch.exe
        usage: |
          ADSearch.exe --search "(&(objectCategory=computer)(msds-allowedtodelegateto=*))" --attributes dnshostname,samaccountname,msds-allowedtodelegateto --json
          ADSearch.exe --search "(&(objectCategory=user)(msds-allowedtodelegateto=*))" --attributes samaccountname,msds-allowedtodelegateto --json


  

comments: 


  